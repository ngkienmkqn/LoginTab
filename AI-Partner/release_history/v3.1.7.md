# v3.1.7 Release Notes

## Release Date: 2026-02-01

## Features

### Anti-Duplicate Click Protection
- Added global `pendingActions` Set to track in-progress operations
- Created `withDebounce(actionKey, fn)` wrapper to prevent duplicate button clicks
- Applied to `saveProfile()` to prevent duplicate account creation when user clicks Save rapidly
- `launch()` already has instant button disable via `openBrowserIds.add()`

### Admin Delete Permission
- Added `created_by_user_id` column to `accounts` table (auto-migration)
- Updated `INSERT accounts` to save creator's user ID
- Updated `delete-account` handler to allow admin to delete accounts they created
- Changed `JOIN` to `LEFT JOIN` in permission check to handle unassigned accounts

## Database Migration
- Auto-runs on startup: adds `created_by_user_id VARCHAR(36)` to `accounts`

## Technical Details

### withDebounce Mechanism
```javascript
var pendingActions = new Set();

async function withDebounce(actionKey, fn) {
    if (pendingActions.has(actionKey)) {
        console.log(`[Debounce] Action "${actionKey}" already in progress.`);
        return null;
    }
    pendingActions.add(actionKey);
    try {
        return await fn();
    } finally {
        pendingActions.delete(actionKey);
    }
}
```

### Delete Permission SQL
```sql
SELECT a.* FROM accounts a
LEFT JOIN account_assignments aa ON a.id = aa.account_id
LEFT JOIN users u ON aa.user_id = u.id
WHERE a.id = ? AND (u.managed_by_admin_id = ? OR aa.user_id = ? OR a.created_by_user_id = ?)
```

## Files Changed
- `src/ui/renderer.js` - Added withDebounce wrapper
- `src/database/mysql.js` - Added created_by_user_id migration
- `main.js` - Updated INSERT accounts and delete-account handler
- `package.json` - Version bump to 3.1.7
